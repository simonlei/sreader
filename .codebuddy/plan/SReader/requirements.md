# SReader 文本阅读器 — 需求文档

## 引言

SReader 是一款 Android 平台的纯文本阅读器应用，旨在为用户提供舒适、高效的中文文本阅读体验。应用采用 Kotlin + Jetpack Compose + Material3 技术栈，支持多种文本编码格式，提供丰富的阅读定制选项，并具备智能的阅读进度管理和统计功能。

**技术栈：** Kotlin、Jetpack Compose、Material3、Hilt、Coroutines、Room、Jetpack Navigation（Single Activity 架构）

---

## 需求

### 需求 1：文件打开与编码支持

**用户故事：** 作为一名读者，我希望能够打开各种编码格式的中文文本文件，以便无障碍地阅读任何来源的文本内容。

#### 验收标准

1. WHEN 用户通过系统文件选择器选择一个文本文件 THEN 系统 SHALL 打开并显示该文件内容
2. WHEN 系统打开文本文件 THEN 系统 SHALL 自动检测文件编码格式（支持 UTF-8、GBK、GB2312、GB18030、Big5 等常见中文编码）
3. IF 自动检码检测失败或显示乱码 THEN 系统 SHALL 提供手动选择编码的选项
4. WHEN 文件内容加载完成 THEN 系统 SHALL 以分页形式展示文本内容，而非滚动模式

---

### 需求 2：界面定制 — 字体与排版

**用户故事：** 作为一名读者，我希望能够调整字体大小和行间距，以便获得最舒适的阅读体验。

#### 验收标准

1. WHEN 用户打开设置面板 THEN 系统 SHALL 提供字体大小调节功能（范围：12sp ~ 36sp，步进 2sp）
2. WHEN 用户调整字体大小 THEN 系统 SHALL 实时预览调整效果并重新分页
3. WHEN 用户打开设置面板 THEN 系统 SHALL 提供行间距调节功能（如：紧凑 / 标准 / 宽松，对应 1.0x / 1.5x / 2.0x 行高倍数）
4. WHEN 用户调整行间距 THEN 系统 SHALL 实时预览调整效果并重新分页
5. WHEN 用户修改字体或行间距设置后退出应用 THEN 系统 SHALL 在下次启动时恢复上次的设置

---

### 需求 3：界面定制 — 背景色、护眼与亮度

**用户故事：** 作为一名读者，我希望能够调整背景色、开启护眼模式和调节亮度，以便在不同环境下保护视力并舒适阅读。

#### 验收标准

1. WHEN 用户打开设置面板 THEN 系统 SHALL 提供多种预设背景色主题（如：白色、米黄、浅绿、深灰/夜间模式）
2. WHEN 用户选择背景色主题 THEN 系统 SHALL 同步调整文字颜色以确保可读性
3. WHEN 用户开启护眼模式 THEN 系统 SHALL 为屏幕叠加暖色滤镜以减少蓝光
4. WHEN 用户在阅读界面调节亮度滑块 THEN 系统 SHALL 调整当前应用的屏幕亮度（不影响系统全局亮度）
5. WHEN 用户修改背景色/护眼/亮度设置后退出应用 THEN 系统 SHALL 在下次启动时恢复上次的设置
6. WHEN 用户正在阅读 THEN 系统 SHALL 保持屏幕常亮，防止自动熄屏

---

### 需求 4：阅读记录与历史管理

**用户故事：** 作为一名读者，我希望应用能记住我每本书的阅读位置和历史记录，以便随时继续阅读而无需手动查找。

#### 验收标准

1. WHEN 用户退出阅读界面或应用 THEN 系统 SHALL 自动保存当前文件的阅读位置（精确到页码/字符偏移量）
2. WHEN 用户再次打开同一文件 THEN 系统 SHALL 自动跳转到上次阅读的位置
3. WHEN 应用启动 THEN 系统 SHALL 显示历史阅读记录列表，按最近阅读时间排序
4. WHEN 系统展示历史记录 AND 某文件已被删除或不可访问 THEN 系统 SHALL 不显示该条记录（或标记为不可用）
5. WHEN 用户在历史记录列表中点击某条记录 THEN 系统 SHALL 打开对应文件并跳转到上次阅读位置
6. WHEN 用户长按历史记录条目 THEN 系统 SHALL 弹出操作菜单（删除记录等）
7. WHEN 用户首次启动应用且无历史记录 THEN 系统 SHALL 显示引导提示，告知用户如何打开文件

---

### 需求 5：分页导航与进度展示

**用户故事：** 作为一名读者，我希望能看到当前阅读进度并快速跳转到指定位置，以便掌握阅读进度和自由定位。

#### 验收标准

1. WHEN 用户正在阅读 THEN 系统 SHALL 在页面底部显示"当前页 / 总页数"信息
2. WHEN 用户点击页面中央区域（或触发设置面板） THEN 系统 SHALL 在底部显示进度拖动条
3. WHEN 用户拖动进度条 THEN 系统 SHALL 实时显示对应页码并在松手后跳转到该页
4. WHEN 文件内容或显示设置发生变化（如字体大小改变） THEN 系统 SHALL 重新计算总页数并更新进度信息

---

### 需求 6：目录识别与跳转

**用户故事：** 作为一名读者，我希望应用能自动识别文本中的章节结构并生成目录，以便快速导航到感兴趣的章节。

#### 验收标准

1. WHEN 文件加载完成 THEN 系统 SHALL 尝试自动识别章节标题（支持常见格式如"第X章"、"第X节"、"Chapter X"、纯数字编号等）
2. IF 系统识别到章节结构 THEN 系统 SHALL 在侧边栏或弹出面板中展示目录列表
3. WHEN 用户点击目录中的某一章节 THEN 系统 SHALL 跳转到该章节对应的页面
4. IF 系统未识别到任何章节结构 THEN 系统 SHALL 隐藏目录入口，不显示空目录
5. WHEN 用户正在阅读某章节 THEN 系统 SHALL 在目录列表中高亮显示当前所在章节

---

### 需求 7：翻页交互

**用户故事：** 作为一名读者，我希望通过直觉化的手势和点击操作来翻页，以便流畅地阅读而不被操作打断。

#### 验收标准

1. WHEN 用户向左滑动 THEN 系统 SHALL 翻到下一页
2. WHEN 用户向右滑动 THEN 系统 SHALL 翻到上一页
3. WHEN 用户点击页面左侧区域（约左侧 1/3） THEN 系统 SHALL 翻到下一页
4. WHEN 用户点击页面右侧区域（约右侧 1/3） THEN 系统 SHALL 翻到下一页
5. WHEN 用户点击页面中央区域（约中间 1/3） THEN 系统 SHALL 显示/隐藏顶部工具栏和底部设置面板
6. WHEN 用户在第一页向右滑动或翻上一页 THEN 系统 SHALL 不执行任何操作或给出轻微提示（已是第一页）
7. WHEN 用户在最后一页向左滑动或翻下一页 THEN 系统 SHALL 不执行任何操作或给出提示（已是最后一页）
8. 系统 SHALL 采用分页模式展示文本，不使用滚动翻页

---

### 需求 8：搜索与跳转

**用户故事：** 作为一名读者，我希望能够搜索文本中的关键词并跳转到匹配位置，以便快速找到我感兴趣的内容。

#### 验收标准

1. WHEN 用户打开搜索功能 THEN 系统 SHALL 在顶部显示搜索输入框
2. WHEN 用户输入搜索关键词并确认 THEN 系统 SHALL 在全文范围内搜索匹配内容
3. IF 搜索到匹配结果 THEN 系统 SHALL 跳转到第一个匹配位置并高亮显示匹配文本
4. WHEN 存在多个匹配结果 THEN 系统 SHALL 提供"上一个/下一个"导航按钮，并显示匹配数量（如"3/15"）
5. IF 未搜索到任何匹配结果 THEN 系统 SHALL 显示"未找到匹配内容"的提示
6. WHEN 用户关闭搜索 THEN 系统 SHALL 取消所有高亮并回到搜索前的阅读位置

---

### 需求 9：阅读时长统计

**用户故事：** 作为一名读者，我希望能够查看自己的阅读时长统计，以便了解和培养阅读习惯。

#### 验收标准

1. WHEN 用户正在阅读 THEN 系统 SHALL 在后台记录阅读时长（精确到秒），关联到具体文件
2. IF 用户离开阅读界面或应用进入后台超过一定时间 THEN 系统 SHALL 暂停计时
3. WHEN 用户打开阅读统计页面 THEN 系统 SHALL 显示以下维度的阅读时长：
   - 按天统计：显示最近 7 天每天的阅读时长
   - 按周统计：显示最近 4 周每周的阅读时长
   - 按月统计：显示最近 12 个月每月的阅读时长
4. WHEN 用户查看统计页面 THEN 系统 SHALL 以柱状图或类似可视化方式展示时长数据
5. WHEN 用户查看统计页面 THEN 系统 SHALL 展示每本书（每个文件）的累计阅读时长

---

## 非功能性需求

1. **性能：** 打开大文件（>10MB）时应在 3 秒内完成加载和首页渲染，分页计算应在后台异步进行
2. **存储：** 所有用户设置、阅读记录、统计数据使用 Room 数据库本地持久化
3. **兼容性：** 最低支持 Android API 26（Android 8.0）
4. **架构：** 采用 Single Activity + Jetpack Navigation 架构，遵循 MVVM 模式
