# SReader 文本阅读器 — 需求文档

## 引言

SReader 是一款 Android 纯文本阅读器应用，面向中文用户，专注于提供流畅、舒适的本地 `.txt` 文本文件阅读体验。应用采用 Kotlin + Jetpack Compose + Material3 技术栈，Single Activity + Jetpack Navigation 架构，数据持久化使用 Room，依赖注入使用 Hilt。

核心能力包括：多编码格式的中文文本支持、可定制的阅读界面（字体/背景/护眼模式）、智能记忆阅读进度、分页翻页浏览、章节目录识别与跳转、全文搜索、以及阅读时长统计分析。

---

## 需求

### 需求 1：文件打开与编码支持

**用户故事：** 作为一名文本阅读爱好者，我希望能够打开各种编码格式的中文文本文件，以便我可以无障碍地阅读任何来源的 txt 文件。

#### 验收标准

1. WHEN 用户通过系统文件选择器选取一个 `.txt` 文件 THEN 系统 SHALL 打开该文件并进入阅读界面展示文本内容
2. WHEN 系统打开一个文本文件 THEN 系统 SHALL 自动检测文件编码格式（至少支持 UTF-8、GBK、GB2312、GB18030、Big5）并以正确的编码进行解码展示
3. IF 编码自动检测不准确导致乱码 THEN 系统 SHALL 提供手动切换编码的选项，用户可从支持的编码列表中选择
4. WHEN 文本文件成功加载 THEN 系统 SHALL 正确渲染所有中文字符，不出现乱码或缺字

---

### 需求 2：阅读界面定制（字体、背景、护眼）

**用户故事：** 作为一名长时间阅读的用户，我希望能够调整字体大小、背景颜色和开启护眼模式，以便在不同环境下获得舒适的阅读体验。

#### 验收标准

1. WHEN 用户在阅读界面打开设置面板 THEN 系统 SHALL 展示字体大小调节控件，支持通过滑块或加减按钮调整字体大小
2. WHEN 用户调整字体大小 THEN 系统 SHALL 实时更新阅读界面的文字显示，字体大小范围为 12sp ~ 36sp
3. WHEN 用户在设置面板选择背景色主题 THEN 系统 SHALL 提供至少 4 种预设背景色主题（如白色、米黄、浅绿、深色/夜间）
4. WHEN 用户切换背景色主题 THEN 系统 SHALL 实时更新阅读界面的背景色和对应的文字颜色
5. WHEN 用户开启护眼模式 THEN 系统 SHALL 为阅读界面叠加一层暖色滤镜，降低蓝光对眼睛的刺激
6. WHEN 用户调整完显示设置并退出应用 THEN 系统 SHALL 持久化保存这些设置，下次打开时自动应用

---

### 需求 3：阅读进度记忆与历史记录

**用户故事：** 作为一名用户，我希望应用能记住我每本书的阅读位置，并且提供历史阅读记录，以便我可以方便地继续上次的阅读。

#### 验收标准

1. WHEN 用户退出阅读界面或关闭应用 THEN 系统 SHALL 自动保存当前文件的阅读位置（精确到页码或字符偏移量）
2. WHEN 用户再次打开同一个文本文件 THEN 系统 SHALL 自动跳转到上次退出时的阅读位置
3. WHEN 用户进入应用首页 THEN 系统 SHALL 展示历史打开过的文本文件列表，按最近打开时间倒序排列
4. WHEN 历史列表中的某个文件已被删除或不可访问 THEN 系统 SHALL 不展示该文件条目
5. WHEN 用户点击历史列表中的文件 THEN 系统 SHALL 打开该文件并自动跳转到上次阅读位置
6. IF 历史记录列表为空 THEN 系统 SHALL 展示引导提示，告知用户可以通过文件选择器打开文本文件

---

### 需求 4：分页展示与页码导航

**用户故事：** 作为一名用户，我希望文本以分页形式展示，并且能看到当前页码和总页数，以便我能掌握阅读进度并快速跳转到指定位置。

#### 验收标准

1. WHEN 文本文件加载完成 THEN 系统 SHALL 根据当前屏幕尺寸、字体大小等参数将文本排版为分页形式展示
2. WHEN 用户在阅读界面 THEN 系统 SHALL 在界面上展示"当前页/总页数"的页码信息
3. WHEN 用户调整字体大小或屏幕方向变化 THEN 系统 SHALL 重新计算分页，同时保持当前阅读位置不变
4. WHEN 用户拖动页面底部的进度滑块 THEN 系统 SHALL 实时跳转到对应的页面位置
5. WHEN 用户通过滑块跳转页面 THEN 系统 SHALL 展示跳转目标页码的预览提示

---

### 需求 5：目录识别与跳转

**用户故事：** 作为一名阅读长篇小说的用户，我希望应用能自动识别文本中的章节目录，以便我可以通过目录快速跳转到指定章节。

#### 验收标准

1. WHEN 文本文件加载完成 THEN 系统 SHALL 尝试通过正则匹配识别文本中的章节标题（如"第X章"、"第X节"、"Chapter X"、以及其他常见的中文章节格式）
2. IF 系统成功识别出目录结构 THEN 系统 SHALL 在阅读界面提供目录入口按钮
3. WHEN 用户点击目录按钮 THEN 系统 SHALL 展示识别出的章节标题列表，并高亮标记当前所在章节
4. WHEN 用户点击目录中的某个章节 THEN 系统 SHALL 跳转到该章节对应的页面位置
5. IF 系统未识别出任何章节结构 THEN 系统 SHALL 隐藏目录按钮或展示"未检测到目录"的提示

---

### 需求 6：翻页交互

**用户故事：** 作为一名手机阅读用户，我希望通过直观的手势操作来翻页，以便获得流畅自然的阅读体验。

#### 验收标准

1. WHEN 用户在阅读界面向左滑动 THEN 系统 SHALL 翻到下一页
2. WHEN 用户在阅读界面向右滑动 THEN 系统 SHALL 翻到上一页
3. WHEN 用户点击阅读页面的右侧区域或中间区域 THEN 系统 SHALL 翻到下一页
4. WHEN 用户点击阅读页面的左侧区域 THEN 系统 SHALL 翻到上一页
5. WHEN 用户已在第一页并尝试翻到上一页 THEN 系统 SHALL 提示"已经是第一页"
6. WHEN 用户已在最后一页并尝试翻到下一页 THEN 系统 SHALL 提示"已经是最后一页"
7. 系统 SHALL NOT 使用上下滚动方式进行翻页，必须采用分页翻页模式
8. WHEN 用户点击页面顶部中间区域 THEN 系统 SHALL 弹出/收起工具栏（包括设置、目录、搜索、进度条等功能入口）

---

### 需求 7：搜索与跳转

**用户故事：** 作为一名用户，我希望能够在文本中搜索关键词并跳转到搜索结果位置，以便快速找到我感兴趣的内容。

#### 验收标准

1. WHEN 用户在阅读界面打开搜索功能 THEN 系统 SHALL 展示搜索输入框
2. WHEN 用户输入关键词并提交搜索 THEN 系统 SHALL 在全文中搜索匹配内容，并展示匹配结果数量
3. WHEN 搜索到匹配结果 THEN 系统 SHALL 跳转到第一个匹配结果所在的页面，并高亮显示匹配的文本
4. WHEN 用户点击"下一个"/"上一个"按钮 THEN 系统 SHALL 依次跳转到下一个/上一个匹配结果所在的页面
5. IF 搜索无匹配结果 THEN 系统 SHALL 展示"未找到匹配内容"的提示
6. WHEN 用户关闭搜索 THEN 系统 SHALL 清除高亮并恢复正常阅读状态

---

### 需求 8：阅读时长统计

**用户故事：** 作为一名想要培养阅读习惯的用户，我希望应用能记录我每本书的阅读时长，并提供按天/周/月的统计分析，以便我了解自己的阅读习惯。

#### 验收标准

1. WHEN 用户在阅读界面进行阅读 THEN 系统 SHALL 实时记录阅读时长（精确到秒），当应用切到后台或用户退出阅读时暂停计时
2. WHEN 用户查看某本书的详情 THEN 系统 SHALL 展示该书的累计阅读时长
3. WHEN 用户进入阅读统计页面 THEN 系统 SHALL 展示按天维度的阅读时长统计（如柱状图或列表）
4. WHEN 用户切换到按周维度 THEN 系统 SHALL 展示每周的总阅读时长统计
5. WHEN 用户切换到按月维度 THEN 系统 SHALL 展示每月的总阅读时长统计
6. WHEN 统计数据中包含多本书的阅读记录 THEN 系统 SHALL 支持按书本分类查看阅读时长
7. WHEN 用户在阅读过程中应用被意外杀死 THEN 系统 SHALL 尽可能保存已记录的阅读时长（定期持久化，避免数据丢失）

---

## 技术约束与边界条件

### 技术栈
- **语言：** Kotlin
- **UI：** Jetpack Compose + Material3
- **架构：** Single Activity + Jetpack Navigation
- **依赖注入：** Hilt
- **数据库：** Room（用于存储阅读进度、历史记录、阅读时长、用户设置等）
- **异步：** Kotlin Coroutines + Flow

### 边界条件
1. **大文件处理：** 对于超大文本文件（如 > 50MB），系统应采用分段加载策略，避免一次性将整个文件载入内存导致 OOM
2. **文件权限：** 应用需要通过 SAF（Storage Access Framework）或 MediaStore 方式访问文件，适配 Android 存储权限策略
3. **性能要求：** 分页计算和翻页操作应确保流畅，翻页响应时间不超过 100ms
4. **数据安全：** 阅读记录和设置数据需要通过 Room 数据库可靠存储，支持 Android 自动备份机制
